# Uderstanding Swift Performance

## Allocation

메모리를 사용할 때 어디로 할당할지 정하는 것을 뜻한다.

## Stack & Heap

- Stack과 Heap은 같은 메모리 공간을 활용한다.
- Stack의 데이터량이 많아져 Heap을 침범하면 StackOverFlow이고, Heap의 데이터량이 많아지면 HeapOverFlow이다.

### Stack

- LIFO 구조로 메모리 할당과 해제가 편한 편이다.
- Stack Pointer를 사용하여 할당 및 해제를 관리한다.
- Stack의 시간복잡도는 O(1)로 상당히 빠르다.

### Heap

- Stack보다 더 복잡한 구조를 가지고 있으며, Heap은 Stack보다 dynamic한 할당 방법을 사용한다.
- Heap 영역에서 사용하지 않은 블록을 찾아서 메모리 할당을 처리한다.  할당을 해제하기 위해서는 해당 메모리를 적절한 위치로 다시 삽입한다.
- 여러 thread가 동시에 Heap에 메모리를 할당할 수 있기 때문에 locking 또는 기타 동기화 메커니즘을 사용하여 무결성을 보호해야 한다.

### 값타입, 참조타입 유형

- 값타입 - 구조체, 열거형
- 참조타입 - 클래스, 액터, 클로저 등…

### Class와 Struct /  Heap과 Stack

- class와 function의 실질적인 데이터는 heap영역에 할당되며, 주소 데이터는 Stack 영역에 저장된다.
- struct는 Stack 영역에 저장된다.
- struct의 인스턴스가 생성되고 복사되면, Stack에서 struct의 전체값이 복사된다.
- class의 인스턴스가 생성되고 복사된다면, Stack에 있는 레퍼런스, 주소값이 복사되고 Heap 영역에 데이터들은 복사가 되지 않는다.
- Heap은 Stack보다 더 많은 비용이 필요하기 때문에, class 특성이 필요하지 않다면 struct를 사용하는게 좋다.

#### Class

![class memory](https://user-images.githubusercontent.com/88870642/211323927-f5b264ed-7f05-4439-8372-29c660fc693c.png)

#### Struct

![struct memory](https://user-images.githubusercontent.com/88870642/211323918-0501d984-6f5d-4c85-8bec-9224c63ff288.png)



## 싱글톤

### 사용 이유

- 프로세스 내에서 단 하나의 인스턴스만 존재해야 하는 경우
- 전역에서 하나의 인스턴스를 공유해야 하는 경우

### 장점

- 인스턴스를 생성할 때마다 메모리 영역을 할당받아야 하는데, 싱글톤을 활용하면 하나의 인스턴스만 사용하여 메모리를 낭비를 방지할 수 있다.
- 전역에서 데이터 공유가 쉽다.

### 단점

- 너무 많은 데이터를 공유할 경우, 타입 간의 결합도가 높아진다.
- 멀티 스레드 환경에서 동기화 처리를 하지 않았을 때, 인스턴스가 2개가 생성되는 문제도 발생할 수 있다.

### 싱글톤이 생성되는 메모리 영역

- 싱글톤은 데이터 영역에 저장된다.
- 데이터 영역은 자신이 사용될 때 메모리를 할당받는다.
- 자신이 사용될 때 메모리를 할당 받기 때문에 멀티 스레드 환경에서 비동기적 처리가 일어날 경우, 인스턴스가 여러개 생길 수 있는 문제점이 생긴다.