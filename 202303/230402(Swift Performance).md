Swift Performance 



Allocation Stack

- Stack을 할당한다는 것은 문자 그대로 정수를 할당하는 비용

![](https://i.imgur.com/MjJDkKo.png)



Allocation Heap

- Heap에는 클래스 인스턴스와 클로저가 저장된다.
- Heap을 사용 하면 메모리 해제를 해줘야 한다.
- 스위프트는 ARP를 통해 힙에 할당된 메모리가 더 이상 쓸모 없어지면 자동으로 해제해준다.

-  코드를 실행하기 전에 Stack에는 `point1`, `point2`의 레퍼런스가 메모리에 할당되어 있다.
- `Point(x: 0, y:0)`이라는 인스턴스를 만들면, Swift는 Heap을 lock하고 무결성을 위해 해당 크기의 메모리 블록을 검색한다.
- point1과 point2의 호출이 끝나면 Heap을 잠그고 사용하지 않은 블록들을 적절한 위치로 재삽입한다.

![](https://i.imgur.com/qixXuE5.png)

🔥 클래스가`let`으로 인스턴스 되도 `let`으로 선언되는 것은 Stack에 있는 주소값이기 때문에 point2.x = 5가 가능하다.







Reference Count

- Heap에 있는 인스턴스에 대한 총 레퍼런스 카운트를 유지한다.
- 이러한 레퍼런스 카운트는 인스턴스 내부에 존재한다.
- 레퍼런스 카운트가 0이 되면 Heap에서 인스턴스를 가리키고 있지않으며, 메모리를 할당 해제 하는 것이 안전하다.





딕셔너리, 배열, 스트링은 heap

스트링은 구조체임에도 불구하고, 적정량이 넘어가면 Heap 영역으로 넘어가서 저장한다. (사용자가 런타임에서 입력을 하여 넣을 때...)

스트링이 변하지 않는다면 heap 영역을 사용하지 않는다.

- 개발자가 이미 입력한 String은 heap 영역 사용 x 그래서 열거형 만드는건가봐요
- 이용자가 입력한 String은 heap 영역 사용







UUID라는 타입 만들어짐





struct 대신 class로 만들면 좋아용( 내부 프로퍼티가 heap영역을 많이 사용하게 되면)

오늘 세션 다시 보기 1시간 40분부터...



다형성이란 무엇인가?

다양한 성질을 가지는 것

사람이라는 클래스에 Eatable, Walkable등의 프로토콜을 채택하면, 매개변수로 Eatable 타입을 받는 메서드에도 사람이라는 클래스를 매개변수로 받을 수 있고, 매개변수로 Walkable 타입을 받는 메서드에도 사람이라는 클래스를 매개변수로 받을 수 있다.

오버라이딩 또한, 다형성을 만들 수 있는 수단이 될 수 있다. 







Allocation

Stack의 경우 빈 공간을 찾지 않기 때문에 빠르다.



Heap은 메모리 블럭들의 크기가 일정하지 않기 때문에, 빈 공간을 찾아가는 과정이 필요하다.

Thread safety overhead때문에 어지럽다.



Method Dispatch 

Static Dispatch

컴파일 타임에 어떤 구현을 실행하도록 결정할 수 있는 것이면 static Dipatch라고 한다.

메서드의 구현부로 바로 갈 수. 있다.

inlining : 함수 안에 구현된 내용으로 가지 않고 컴파일할 때, 함수 호출 부분에 복붙을 해놓고 실행시킨다.

컴파일이 최적화해준다.

다시보기 2시간 10분





Dynamic Dispatch는 컴파일러가 컴파일타임에 어떤 구현을 실행할건지 결정할 수 없다. 

런타임때만 실제로 구현된 곳으로 jump하게 된다.

따라서 비용이 static dispatch보다 크다.